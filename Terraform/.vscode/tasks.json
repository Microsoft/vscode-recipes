{
    "version": "2.0.0",
    "windows": {
        "options": {
            "shell": {
                "executable": "cmd.exe",
                "args": ["/d", "/c"],
            },
        }
    },
    "tasks": [
        {
            "label": "az login",
            "type": "shell",
            "command": "az login && az account set -s ${config:terraform.azurerm.subscription_id}",
            "problemMatcher": []
        },
        {
            "label": "terraform create backend",
            "type": "shell",
            "windows": {
                "command": "${workspaceFolder}/create-backend.bat"
            },
            "linux": {
                "command": "${workspaceFolder}/create-backend.sh"
            },
            "command": "${workspaceFolder}/create-backend.sh",
            "problemMatcher": [],
            "args": [
                "${config:terraform.azurerm.backend.resource_group}",
                "${config:terraform.azurerm.backend.storage_account}",
                "${config:terraform.azurerm.backend.container}",
                "${config:terraform.azurerm.location}"
            ]
        },
        {
            "label": "terraform init",
            "type": "shell",
            "command": "terraform",
            "problemMatcher": [],
            "args": [
                "init",
                "-backend-config=\"resource_group_name=${config:terraform.azurerm.backend.resource_group}\"",   
                "-backend-config=\"storage_account_name=${config:terraform.azurerm.backend.storage_account}\"",
                "-backend-config=\"container_name=${config:terraform.azurerm.backend.container}\"",
                "-backend-config=\"key=${config:terraform.azurerm.backend.key}\"",                           
                "-backend-config=\"subscription_id=${config:terraform.azurerm.subscription_id}\"",
                "-backend-config=\"tenant_id=${config:terraform.azurerm.tenant_id}\"",
            ],
            "options": {
                "cwd": "${workspaceFolder}/templates"
            }
        },
        {
            "label": "terraform validate",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/templates"
            },
            "command": "terraform",
            "problemMatcher": [],
            "args": [
                "validate"
            ]
        },
        {
            "label": "terraform fmt",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/templates"
            },
            "command": "terraform",
            "problemMatcher": [],
            "args": [
                "fmt",
                "--recursive"
            ]   
        },
        {
            "label": "tflint",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/templates"
            },
            "command": "tflint",
            "problemMatcher": []
        },
        {
            "label": "terraform plan",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/templates"
            },
            "command": "terraform",
            "problemMatcher": [],
            "args": [
                "plan"
            ]
        },
        {
            "label": "terraform apply",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/templates"
            },
            "command": "terraform",
            "problemMatcher": [],
            "args": [
                "apply"
            ]
        },
        {
            "label": "terraform destroy",
            "type": "shell",
            "options": {
                "cwd": "${workspaceFolder}/templates"
            },
            "command": "terraform",
            "problemMatcher": [],
            "args": [
                "destroy"
            ]
        },
    ]
}